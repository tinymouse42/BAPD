      ________      _____ ______       ________      ________
      |\_____  \    |\   _ \  _   \    |\   __  \    |\   ____\
       \|___/  /|   \ \  \\\__\ \  \   \ \  \|\  \   \ \  \___|
           /  / /    \ \  \\|__| \  \   \ \   __  \   \ \  \
          /  /_/__    \ \  \    \ \  \   \ \  \ \  \   \ \  \____
         |\________\   \ \__\    \ \__\   \ \__\ \__\   \ \_______\
          \|_______|    \|__|     \|__|    \|__|\|__|    \|_______|

___ _  _        _  __ _  _     __ _  _  __ __    _  __ __ __    _     __ _
 _/(_)/ \   |V||_|/  |_)/ \   /  |_)/ \(_ (_ ---|_|(_ (_ |_ |V||_)|  |_ |_)
/__(_)\_/   | || |\__| \\_/   \__| \\_/__)__)   | |__)__)|__| ||_)|__|__| \



zmac -i -m -o hello.bin -x hello.lst hello.asm

NAME
	zmac - Z80 macro cross-assembler

VERSION
	1.3 - (Abridged Documentation)


DESCRIPTION
       zmac is a Z80 macro cross-assembler. It has all  the  fea-
       tures  you'd expect. It assembles the specified input file
       (with a `.z' extension if there is no pre-existing  exten-
       sion and the file as given doesn't exist) and produces raw
       binary output in a `.bin' file. (It can optionally produce
       CP/M-style  Intel  hex  format - see below.) By default it
       also produces a nicely-formatted listing of the m/c along-
       side the source, in a `.lst' file.

       As  well  as normal Z80 programs, zmac lets you write 8080
       programs in Z80 assembly. (See the `-z' option below.)

SYNTAX

       zmac [-fhimsSz] [-o output_file] [-x list_file] [source_file]

       Example: zmac -f -i -m -o program.bin -x program.lst program.asm

OPTIONS

Output Control

	-h: Output Intel hex format (.hex) instead of a raw binary (.bin).
	-o [outfile]: Specify the name of the output file for the assembled code.
	-x [listfile]: Specify the name of the output file for the listing.

Listing Control

	-f: Include instructions omitted from assembly due to if conditions.
	-i: Omit listing any files included using the include directive.
	-m: Show detailed macro expansions within the listing.
	-s: Don't include the symbol table in the listing.
	-S: Show source code lines causing errors, not just canonical error format.

Information:

	--help: Display a summary of all available options.
	--version: Print the version of zmac.


==========================================================



INPUT FORMAT
       zmac uses the standard Zilog mnemonics and directives.

Memory and Data Allocation

ORG: Sets the origin address for the following code or data.
DEFB: Defines a single byte of data (similar to DB).
DEFW: Defines a word (two bytes) of data (similar to DW).
DEFS: Reserves a block of memory (similar to DS).

Symbol Definition

EQU: Assigns a constant value to a symbol.
SET: Similar to EQU, but the value of the symbol can be redefined.

Conditional Assembly

IF / ELSE / ENDIF: Controls whether blocks of code are assembled based on conditions.

Macros

MACRO / ENDM: Defines a block of code as a macro, allowing for code reuse and parameterization.

Including Files

INCLUDE: Inserts the content of another assembly file into the current file.

Other Important Directives

END: Signals the end of the assembly source code.
TITLE: Sets the title used in the listing file.

===============================================================================


       Input can be upper or lowercase.

       Comments  start  with  `;'  and carry on to the end of the
       line.



Version 1.3                 2000-07-02                          2





zmac(1)                 Development Tools                 zmac(1)


       Labels are declared with `label:', `.label',  `:label'  or
       just  `label' - indentation is unimportant. (Labels can be
       up to 40 chars long.)

       Number constants can take a trailing h or a leading  &,  $
       or  #  for hex, a trailing b for binary, a trailing o or q
       for octal, or a trailing d for decimal.

       Here is how other things work:

       defb 42
              A byte.  `ascii', `byte', `db', `defm'  and  `text'
              are synonyms.

       defb 'foobar'
              An  ASCII  character  string  (not NUL-terminated).
              Double quotes can also be used.

       defb 'Who needs MS-DOG when you have *CP/M*?', 13, 10, '$'
              Strings, bytes, and comp.os.msdos.programmer troll.
              :-)

       defw 2112
              A word (16 bits).  `word' and `dw' are synonyms.

       defs 500
              Insert 500 zero bytes.  `block',  `ds'  and  `rmem'
              are synonyms.

       org    Set the address to assemble to.

       equ    Define  a symbol to have a fixed value.  The symbol
              can be used before it is defined.  A symbol defined
              with  `equ' or as a label can be defined only once,
              except that a symbol  defined  with  `equ'  may  be
              redefined to the same value.

       defl   Define  a  symbol  to have a changeable value.  The
              symbol cannot be used before it is defined, and  it
              can  be  redefined  to a different value later with
              another `defl'.

       end    Ends the input.   Any  lines  after  an  `end'  are
              silently  ignored.  If an arg is given, it declares
              the entry address for the  program.   This  has  no
              effect if zmac is writing a raw binary file.  In an
              Intel hex file, it generates an S-record  directing
              0  bytes of data to be loaded at the given address.

       if ... [ else ... ] endif
              For conditional assembly. If you do  `if  foo'  and
              foo  evaluates  to zero, all the lines up until the
              next corresponding `else' or `endif' are completely
              ignored.  Conversely, if foo evaluates to non-zero,



Version 1.3                 2000-07-02                          3





zmac(1)                 Development Tools                 zmac(1)


              any  lines  from  a  corresponding  `else'  to  the
              `endif'   are   ignored.    Ifs   can   be  nested.
              `cond'/`endc' are synonyms for `if'/`endif'.

       rsym and wsym
              Read/write a symbol file.  These  simply  load/save
              the  currently  defined  symbols  from/to  the file
              specified (in a non-portable format). `rsym'  takes
              place  at  the  point it is encountered in the file
              (on the first pass); `wsym' is delayed until assem-
              bly has finished.

       include
              Include  a  file.  Like C's (well, cpp's) #include,
              but the filename arg lacks the  angle  brackets  or
              quotes  (though  quotes  may be used).  `read' is a
              synonym.

ODDITIES
       There are the following oddities:

       cmp    Same as `cp'.

       jmp    Same as `jp'.

       jp hl  Same as `jp (hl)'.  Ditto for ix and iy.

       ld hl, 'LH'
              Oh, yes!  Ditto for bc, de, sp, ix and iy.

       min and max
              Same as `defl' except that the symbol is defined as
              the   smaller  or  bigger  of  two  comma-separated
              expressions.

       v and nv
              These are alternatives to  `pe'  and  `po'  respec-
              tively  in  `jp'  and  `call' instructions, meaning
              that tests on the Z80's (parity/)overflow flag  can
              be  written  in  the  same format (`x'/`nx') as for
              those on the zero or carry flags.

LISTING PSEUDO-OPS
       There are several pseudo-ops for controlling the  listing.
       None of these ops appear in the listing themselves:

       eject  Start a new listing page.

       nolist Do  nothing.  This can be used to have a comment in
              the source but not the listing, I suppose.

       elist, flist, glist, mlist
              These have the same effect as  the  similarly-named
              command-line  options,  though  possibly  with  the



Version 1.3                 2000-07-02                          4





zmac(1)                 Development Tools                 zmac(1)


              sense reversed depending on the default. Use an arg
              >0 (or no arg) to enable, and an arg <0 to disable.

       list   Sets whether to list or not. You can  use  this  to
              avoid  listing  certain  parts of the source. Takes
              same optional arg as `elist', etc..

       title  Set title (used in listing and symbol file).

       space  Output arg blank lines in the listing, or one  line
              if no arg is given.

EXPRESSIONS
       Expressions are reasonably full-featured; here is the com-
       plete list of operators, highest-precedence first.  Opera-
       tors  separated only by a space are synonyms; for example,
       `~' is the same as `not'.

              ! (logical), ~ not (bitwise), + (unary), - (unary)

              *, /, % mod

              +, -

              << shl, >> shr

              < lt, > gt, <= le, >= ge

              == = eq, != <> ne

              & and (bitwise)

              ^ xor (bitwise)

              | or (bitwise)

       You can use normal parentheses or square brackets to over-
       ride  the  precedence  rules;  use  square  brackets where
       parentheses would conflict with Z80 mnemonic syntax.

MACROS
       The following defines a macro named m with  zero  or  more
       formal parameters p1, p2, ..., pn, zero or more local sym-
       bols ?s1, ?s2, ..., ?sm, and body b1, b2, ...:

              m macro p1, p2, ..., pn, ?s1, ?s2, ..., ?sm

                b1

                b2

                ...

                endm



Version 1.3                 2000-07-02                          5





zmac(1)                 Development Tools                 zmac(1)


       The macro is called by writing:

              m v1, v2, ..., vn

       A macro call expands to the text of the macro's body, with
       each  occurrence  of a formal parameter pk replaced by the
       corresponding value vk, and with  each  local  symbol  ?sk
       replaced  by  a new, unique symbol invented for this call.
       Invented symbols begin with `?', so you should avoid using
       such symbols elsewhere in your program.

       zmac  currently  does not check that you have provided the
       right number of parameters when calling a macro.   If  you
       provide  too  few, unmatched formals are replaced with the
       empty string.  If you provide  too  many,  the  additional
       values  begin  to  replace  local  symbols as if they were
       ordinary parameters.  (This could  be  considered  a  fea-
       ture.)   After  the  local symbols are all replaced, addi-
       tional parameters are silently ignored.

FILENAMES
       To allow source files to be portable, a  canonical  format
       should  be  used  for  filenames  in source files (i.e. in
       include, rsym or wsym statements).  This canonical  format
       is basically the Un*x format: `/' as the directory separa-
       tor, `.' as the extension separator, ".."  as  the  parent
       directory, "." as the current directory, and a leading `/'
       as the root directory (this should be avoided as it  makes
       moving the source non-trivial).

       For  maximum  portability,  no  element of such a filename
       should have more than 10  characters,  contain  characters
       other  than  0-9, a-z, underscore and `.', or contain more
       than one `.'.

       Filenames passed as command-line arguments (i.e.  for  the
       source  specification,  or for the -o or -x options), how-
       ever, are assumed to be in the local (non-canonical)  for-
       mat;  this  includes the extension separator (whether sup-
       plied or added) and any drive specifiers.

       The OSes which are currently supported are Un*x, BeOS, DOS
       and RISC OS.

MISCELLANEOUS
       In  the  symbol table listing, the `=' prefix is given for
       those symbols defined by `equ' or `defl', and the `+' suf-
       fix is given for those which were not used.

EXIT STATUS
       0      No errors.

       1      One  or  more errors were found during assembly, or
              zmac exited with a fatal error.



Version 1.3                 2000-07-02                          6





zmac(1)                 Development Tools                 zmac(1)


BUGS
       zmac reports each error in  a  line  separately.  This  is
       probably  a good thing, but tends to effectively result in
       the same overall problem being reported twice (e.g. a ref-
       erence  to  an  undefined symbol causes both an undeclared
       error and a value error).

       The  man  page  isn't  what  you'd  call  extensive.  This
       shouldn't be too surprising as I had to RTFS to WTFM. :-)

       What do phase/dephase do (they seem to be some way of tem-
       porarily moving the program location -- for overlays?)?

SEE ALSO
       as(1)

AUTHOR
       Bruce Norskog (in 1978!).

       Updates and bugfixes over the years  by  John  Providenza,
       Colin  Kelley,  and  more  recently by Russell Marks, Mark
       RISON, Chris Smith, Matthew Phillips and Tim Mann.

       Russell Marks wrote most of the man page, with  tweaks  by
       Mark RISON and Tim Mann.
































Version 1.3                 2000-07-02                          7


